<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Sona Template" />
    <meta name="keywords" content="Sona, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Review Booking</title>
    <link rel="icon" href="../img/icon.png">

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css?family=Lora:400,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Cabin:400,500,600,700&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
      crossorigin="anonymous"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="../css/flaticon.css" type="text/css" />
    <link rel="stylesheet" href="../css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="../css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="../css/jquery-ui.min.css" type="text/css" />
    <link rel="stylesheet" href="../css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="../css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="../css/style.css" type="text/css" />

    <link rel="stylesheet" href="../css/breadcrumb.css" type="text/css" />
    <style>
      .invoice {
        background: #fff;
        padding: 20px;
      }

      .invoice-company {
        font-size: 20px;
      }

      .invoice-header {
        margin: 0 -20px;
        background: #f0f3f4;
        padding: 20px;
      }

      .invoice-date,
      .invoice-from,
      .invoice-to {
        display: table-cell;
        width: 1%;
      }

      .invoice-from,
      .invoice-to {
        padding-right: 20px;
      }

      .invoice-date .date,
      .invoice-from strong,
      .invoice-to strong {
        font-size: 16px;
        font-weight: 600;
      }

      .invoice-date {
        text-align: left;
      }

      .invoice-price {
        background: #f0f3f4;
        display: table;
        width: 100%;
      }

      .invoice-price .invoice-price-left,
      .invoice-price .invoice-price-right {
        height: 1rem !important;
        display: table-cell;
        padding: 20px;
        font-size: 20px;
        font-weight: 600;
        width: 30%;
        position: relative;
        vertical-align: middle;
      }

      .invoice-price .invoice-price-left .sub-price {
        display: table-cell;
        vertical-align: middle;
        padding: 0 20px;
      }

      /* @media only screen and (max-width: 600px) {
          .invoice-price .invoice-price-left .sub-price {
        display: table-cell;
        vertical-align: middle;
        padding: 0 4px;
      }

      } */

      .invoice-price small {
        font-size: 12px;
        font-weight: 400;
        display: block;
      }

      .invoice-price .invoice-price-row {
        display: table;
        float: left;
      }

      .invoice-price .invoice-price-right {
        width: 19%;
        height: 7rem !important;
        background: #2d353c;
        color: #fff;
        font-size: 28px;
        text-align: center;
        vertical-align: bottom;
        font-weight: 300;
      }

      /*  @media only screen and (max-width: 600px) {
          .invoice-price .invoice-price-right {
        width: 25%;
        background: #2d353c;
        color: #fff;
        font-size: 20px;
        text-align: right;
        vertical-align: bottom;
        font-weight: 300;
      }
      } */

      .invoice-price .invoice-price-right small {
        display: block;
        opacity: 0.6;
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 12px;
      }

      .invoice-footer {
        border-top: 1px solid #ddd;
        padding-top: 10px;
        font-size: 10px;
      }

      .invoice-note {
        color: #999;
        margin-top: 80px;
        font-size: 85%;
      }

      .invoice > div:not(.invoice-footer) {
        margin-bottom: 20px;
      }

      .btn.btn-white,
      .btn.btn-white.disabled,
      .btn.btn-white.disabled:focus,
      .btn.btn-white.disabled:hover,
      .btn.btn-white[disabled],
      .btn.btn-white[disabled]:focus,
      .btn.btn-white[disabled]:hover {
        color: #2d353c;
        background: #fff;
        border-color: #d9dfe3;
      }
    </style>
  </head>

  <body>
    <!-- Page Preloder -->
    <div id="preloder">
      <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Section Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="canvas-open">
      <i class="icon_menu"></i>
    </div>
    <div class="offcanvas-menu-wrapper">
      <div class="canvas-close">
        <i class="icon_close"></i>
      </div>
      <nav class="mainmenu mobile-menu">
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="../rooms.html">Rooms</a></li>
          <li><a href="../gallery.html">Gallery</a></li>
          <li><a href="../aboutus.html">About Us</a></li>
          <li><a href="../contact.html">Contact</a></li>
          <li>
            <a href="../my_booking.html">
              My Booking
              <i class="fa fa-search" aria-hidden="true"></i
            ></a>
          </li>
        </ul>
      </nav>
      <div id="mobile-menu-wrap"></div>
      <div class="top-social">
        <a href="#"><i class="fa fa-facebook"></i></a>
      </div>
      <ul class="top-widget">
        <li><i class="fa fa-phone"></i> (12) 345 67890</li>
        <li><i class="fa fa-envelope"></i> fairfieldsresort2020@gmail.com</li>
      </ul>
    </div>
    <!-- Offcanvas Menu Section End -->

    <!-- Header Section Begin -->
    <header class="header-section header-normal">
      <div class="menu-item">
        <div class="container">
          <div class="row">
            <div class="col-lg-2">
              <div class="logo">
                <a href="../index.html">
                  <img src="../img/resort-logo.png" alt="" />
                </a>
              </div>
            </div>
            <div class="col-lg-10">
              <div class="nav-menu">
                <nav class="mainmenu">
                  <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../rooms.html">Rooms</a></li>
                    <li><a href="../gallery.html">Gallery</a></li>
                    <li><a href="../aboutus.html">About Us</a></li>
                    <li><a href="../contact.html">Contact</a></li>
                    <li>
                      <a href="../my_booking.html">
                        My Booking
                        <i class="fa fa-search" aria-hidden="true"></i
                      ></a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Header End -->

    <!-- Breadcrumb Section Begin -->
    <div class="bread">
      <div class="breadcrumb-pagination">
        <div class="completed">
          <span>1</span>
          <p>Select Dates</p>
        </div>
        <div class="completed">
          <span>2</span>
          <p>Rooms</p>
        </div>
        <div class="completed">
          <span>3</span>
          <p>Guest Detail</p>
        </div>
        <div class="active">
          <span>4</span>
          <p>Review</p>
        </div>
        <div class="todo">
          <span>5</span>
          <p>Confirmation</p>
        </div>
      </div>
    </div>

    <!--<div class="breadcrumb-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-text">
                        <h2>Our Rooms</h2>
                        <div class="bt-option">
                            <a href="./home.html">Home</a>
                            <span>Rooms</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    <!-- Breadcrumb Section End -->

    <!-- Room Details Section Begin -->
    <section class="hero-section">
      <div class="container">
        <div class="invoice">
          <div class="row">
            <!-- begin invoice-company -->
            <div class="col-12">
              <div class="invoice-company text-inverse f-w-600">
                <h2 class="text-muted">Booking Summary</h2>
              </div>
              <!-- end invoice-company -->
              <!-- begin invoice-header -->
              <div class="invoice-header mt-2">
                <div class="row">
                  <div class="col-xl-4 col-lg-12">
                    <div class="invoice-from">
                      <h4 class="text-info">Guest Information</h4>
                      <address class="m-t-5 m-b-5">
                        <h5 class="mt-2"><b id="guest_name"></b></h5>
                        <h6 class="m-1">Address: <b id="guest_address"></b></h6>
                        <h6 class="m-1">Phone: <b id="guest_contact"></b></h6>
                        <h6 class="m-1">E-mail: <b id="guest_email"></b></h6>
                      </address>
                    </div>
                  </div>
                  <div class="col-xl-4 col-lg-12">
                    <div class="invoice-to">
                      <h4 class="text-success">Booking Information</h4>
                      <address class="m-t-5 m-b-5">
                        <h5 class="m-1">Check-in: <b id="check_in"></b></h5>
                        <h5 class="m-1">Check-out: <b id="check_out"></b></h5>
                        <h5 class="m-1">No. Night(s): <b id="nights"></b></h5>
                        <h5 class="m-1">No. Guest: <b id="guest_num"></b></h5>
                        <!--<h5 class="m-1">Booking Number: <b>09066000801</b></h5>-->
                      </address>
                    </div>
                  </div>
                  <div class="col-xl-4 col-lg-12">
                    <div class="invoice-date">
                      <h4 class="text-dark">Resort</h4>
                      <address class="m-t-5 m-b-5">
                        <strong class="text-inverse"
                          >Fairfields Resort and Playhouse Inn</strong
                        ><br />
                        Padilla St.<br />
                        San Carlos City, Pangasinan, Philippines<br />
                        Phone: <b class="text-danger">(63) 935-536-0312</b
                        ><br />
                        Email:<b class="text-danger">
                          fairfieldsresort@yahoo.com</b
                        >
                        <br />
                        LANDBANK Account:
                        <b class="text-danger">4455-56349-448</b>
                      </address>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- end invoice-header -->
            <!-- begin invoice-content -->
            <div class="col-12">
              <div class="invoice-content">
                <!-- begin table-responsive -->
                <div class="table-responsive">
                  <table class="table table-invoice" id="invoice">
                    <thead>
                      <tr>
                        <th>Availed Room</th>
                        <th>Rate</th>
                        <th>Night(s)</th>
                        <th>Qty</th>
                        <th>Amount</th>
                      </tr>
                    </thead>
                    <tbody id="#invoice"></tbody>
                    <tfoot>
                      <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>Vatable Sales</th>
                        <th id="vatable">PHP 16,15351</th>
                      </tr>
                      <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>VAT (12%)</th>
                        <th id="vat"></th>
                      </tr>
                      <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>Sub Total</th>
                        <th id="sub_total"></th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
                <!-- end table-responsive -->
                <!-- begin invoice-price -->

                <div class="invoice-price">
                  <div class="row">
                    <div class="col-xl-6 col-md-12">
                      <div class="invoice-price-left">
                        <div class="d-flex justify-content-center"">
                        <div class="sub-price">
                          <h5>DOWN PAYMENT</h5>
                          <span class="text-inverse" id="downpayment"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-6 col-md-12">
                    <div class="invoice-price-right">
                      <h5 class="text-light">TOTAL AMOUNT</h5>
                      <span class="f-w-600" id="total_amount"></span>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end invoice-price -->
            </div>
          </div>

          <div class="col-12">
            <div class="invoice-note">
              <div class="row">
                <div class="col-xl-6 col-lg-12">
                  <h4>HOW TO PAY?</h4>
                  <p>
                    * Payment is available only for Bank Deposit <br />
                    * After Confirming, You will receive an Email w/ Booking
                    Number<br />
                    * Deposit your 50% Downpayment to bank, and upload your bank
                    receipt<br />
                    <a
                      class="text-primary"
                      href="https://fairfieldsresort.com/mybookings.html"
                      >(click here to find your booking using your booking
                      number and email)</a
                    ><br />
                    * Wait your booking status to be confirmed.
                  </p>
                </div>
                <div class="col-xl-6 col-lg-12">
                  <h4>POLICY CONDITIONS</h4>
                  <p>
                    * You need to pay your 50% downpayment before 24hours or<br />
                    the reservation will be voided<br />
                    * Payment is strictly 50% downpayment only<br />
                    to be the reservation will be confirmed<br />
                    * No refund.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <!-- end invoice-content -->
          <!-- begin invoice-note -->

          <!-- end invoice-note -->
          <!-- begin invoice-footer -->
          <div class="col-12">
            <div class="invoice-footer">
              <button class="btn btn-primary btn-lg btn-block" id="confirm">
                CONFIRM
              </button>
              <!--  <p class="text-center m-b-5 f-w-600">
                THANK YOU FOR YOUR BUSINESS
              </p>
              <p class="text-center">
                <span class="m-r-10"
                  ><i class="fa fa-fw fa-lg fa-globe"></i>
                  matiasgallipoli.com</span
                >
                <span class="m-r-10"
                  ><i class="fa fa-fw fa-lg fa-phone-volume"></i>
                  T:016-18192302</span
                >
                <span class="m-r-10"
                  ><i class="fa fa-fw fa-lg fa-envelope"></i>
                  rtiemps@gmail.com</span
                >
              </p>-->
            </div>
          </div>
          <!-- end invoice-footer -->
        </div>
      </div>
    </section>
    <!-- Room Details Section End -->

    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Note</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Additional Guest is upon check-in
          </div>
          <div class="modal-footer"></div>
        </div>
      </div>
    </div>

    <!-- Footer Section Begin -->
    <footer class="footer-section">
      <div class="container">
        <div class="footer-text">
          <div class="row">
            <div class="col-lg-6">
              <div class="ft-about">
                <div class="logo">
                  <a href="#">
                  <img src="../img/name-logo.png" alt="" class="ml-n3"/>
                  </a>
                </div>
                <div class="fa-social">
                  <a href="#"><i class="fa fa-facebook"></i></a>
                </div>
              </div>
            </div>
            <div class="col-lg-3 offset-lg-1">
              <div class="ft-contact">
                <h6>Contact Us</h6>
                <ul>
                  <li>(63) 93 5536 0312</li>
                  <li>fairfieldsresort@yahoo.com</li>
                  <li>Padilla St. 2420 San Carlos City, Pangasinan</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="copyright-option">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="co-text">
                <p>
                  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                  Copyright &copy;
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  All rights reserved
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Search model Begin -->
    <div class="search-model">
      <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch"><i class="icon_close"></i></div>
        <form class="search-model-form">
          <input type="text" id="search-input" placeholder="Search here....." />
        </form>
      </div>
    </div>
    <!-- Search model end -->

    <!-- Js Plugins -->
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jquery.magnific-popup.min.js"></script>
    <!--<script src="../js/jquery.nice-select.min.js"></script> -->
    <script src="../js/jquery-ui.min.js"></script>
    <script src="../js/jquery.slicknav.js"></script>
    <script src="../js/owl.carousel.min.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/web_scripts/scriptvalidation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  </body>

  <script>
    $(document).ready(function () {
      if (
        sessionStorage.getItem("checkin_date") == null ||
        sessionStorage.getItem("checkin_date") == null ||
        sessionStorage.getItem("room_details") == null ||
        sessionStorage.getItem("guest_details") == null
      )
        window.location = "../index.html";

      let guest_details = JSON.parse(sessionStorage.getItem("guest_details"));

      var today = moment();
      var tomorrow = moment(today).add(1, "days");

      $("#guest_name").html(
        guest_details.first_name + " " + guest_details.last_name
      );
      $("#guest_num").html(guest_details.num_guest);
      $("#guest_address").html(guest_details.address);
      $("#guest_contact").html(guest_details.contact_num);
      $("#guest_email").html(guest_details.email);

      let check_in = new Date(sessionStorage.getItem("checkin_date"));
      let check_out = new Date(sessionStorage.getItem("checkout_date"));

      let timediff = check_out.getTime() - check_in.getTime();
      let nights = timediff / (1000 * 3600 * 24);

      $("#check_in").html(
        moment(sessionStorage.getItem("checkin_date")).format("DD MMMM YYYY")
      );
      $("#check_out").html(
        moment(sessionStorage.getItem("checkout_date")).format("DD MMMM YYYY")
      );
      $("#nights").html(nights);

      let room_details = JSON.parse(sessionStorage.getItem("room_details"));

      let sub_total = 0;
      room_details.map((room) => {
        sub_total += room.new_price;
        $("#invoice").append(
          "<tr>" +
            "<td>" +
            room.roomtype_name +
            "</td>" +
            "<td>PHP " +
            room.new_price / room.num_rooms / nights+
            ".00</td>" +
            "<td>" +
            nights +
            "</td>" +
            "<td>" +
            room.num_rooms +
            "</td>" +
            "<td>PHP " +
            room.new_price  +
            ".00</td>" +
            "</tr>"
        );
      });

      let total_amount = sub_total;
      let VAT = total_amount * 0.12;
      let vatable_sales = total_amount - VAT;
      let downpayment = total_amount / 2;

      $("#vatable").html("PHP " + vatable_sales + ".00");
      $("#vat").html("PHP " + VAT + ".00");
      $("#sub_total").html("PHP " + total_amount + ".00");
      $("#downpayment").html("PHP " + downpayment + ".00");
      $("#total_amount").html("PHP " + total_amount + ".00");

      let selected_rooms = [];

      $("#confirm").click(() => {
        $("#confirm").attr("disabled", "disabled");
        $.LoadingOverlay("show", {
          image: "",
          progress: true,
        });
        var count = 0;
        var interval = setInterval(function () {
          if (count >= 100) {
            clearInterval(interval);
            $.LoadingOverlay("hide");
            return;
          }
          count += 20;
          $.LoadingOverlay("progress", count);
        }, 300);

        room_details.map((room) => {
          room.room_ids.map((rooms) => {
            selected_rooms.push(rooms);
          });
        });

        let reservation_id = parseInt(
          Date.now().toString().substring(1, 5) +
            parseInt(Math.random().toString().substring(2, 6))
        );

        let guest_id = parseInt(
          Date.now().toString().substring(2, 6) +
            parseInt(Math.random().toString().substring(3, 7))
        );

        let billing_id = parseInt(
          Date.now().toString().substring(3, 7) +
            parseInt(Math.random().toString().substring(4, 8))
        );

        let new_check_in = moment(check_in).format("YYYY-MM-DD");
        let new_check_out = moment(check_out).format("YYYY-MM-DD");

        $.ajax({
          url: "../php_functions/validate_rooms.php",
          data:
            "selected_rooms=" +
            JSON.stringify(selected_rooms) +
            "&checkin_date=" +
            new_check_in +
            "&checkout_date=" +
            new_check_out,
          type: "POST",
          success: function (response) {
            let res = response;
            if (res == '"1"') {
              if (moment(tomorrow._d).format("YYYY-MM-DD") == new_check_in) {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text:
                      "You have until today 11:59PM to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              } else {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text:
                      "You have 24 Hours to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              }

              $.ajax({
                url: "../php_functions/insert_reservation.php",
                data:
                  "guest_id=" +
                  guest_id +
                  "&first_name=" +
                  guest_details.first_name +
                  "&last_name=" +
                  guest_details.last_name +
                  "&gender=" +
                  guest_details.gender +
                  "&contact_number=" +
                  guest_details.contact_num +
                  "&email=" +
                  guest_details.email +
                  "&address=" +
                  guest_details.address +
                  "&city=" +
                  guest_details.city +
                  "&zip_code=" +
                  guest_details.zipcode +
                  "&reservation_id=" +
                  reservation_id +
                  "&billing_id=" +
                  billing_id +
                  "&checkin_date=" +
                  new_check_in +
                  "&num_guest=" +
                  guest_details.num_guest +
                  "&checkout_date=" +
                  new_check_out +
                  "&reservation_type=" +
                  0 +
                  "&status=" +
                  0 +
                  "&room_details=" +
                  JSON.stringify(room_details),
                type: "POST",
                success: function (response) {
                  localStorage.clear();
                },
              });

              setTimeout(() => {
                window.location = "../index.html";
              }, 7200);
            } else {
              setTimeout(function () {
                Swal.fire({
                  icon: "warning",
                  title: "Oops...",
                  text: "Something went wrong!, Booking Unsuccessfull",
                  footer:
                    "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                  timer: 5000,
                  showCancelButton: false,
                  showConfirmButton: false,
                });
              }, 2100);

              setTimeout(() => {
                window.location = "../index.html";
              }, 7100);
            }
          },
        });
      });
    });
  </script>
</html>

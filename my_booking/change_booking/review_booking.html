<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Sona Template" />
    <meta name="keywords" content="Sona, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Fairfields Resort & Playhouse Inn | My Booking</title>

    <link rel="icon" href="../../img/icon.png" />
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css?family=Lora:400,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Cabin:400,500,600,700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../datepicker_files/jquery.datepicker2.css" />
    <link rel="stylesheet" href="../datepicker_files/breadcrumb.css" />

    <link rel="stylesheet" href="../../admin/plugins/toastr/toastr.min.css" />
    <link
      rel="stylesheet"
      href="../../admin/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css"
    />

    <link
      rel="stylesheet"
      href="../../admin/plugins/datatables-bs4/css/dataTables.bootstrap4.css"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="../../css/bootstrap.min.css" type="text/css" />
    <link
      rel="stylesheet"
      href="../../css/font-awesome.min.css"
      type="text/css"
    />
    <link rel="stylesheet" href="../../css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="../../css/flaticon.css" type="text/css" />
    <link
      rel="stylesheet"
      href="../../css/owl.carousel.min.css"
      type="text/css"
    />
    <link rel="stylesheet" href="../../css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="../../css/jquery-ui.min.css" type="text/css" />
    <link
      rel="stylesheet"
      href="../../css/magnific-popup.css"
      type="text/css"
    />
    <link rel="stylesheet" href="../../css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="../../css/style.css" type="text/css" />

    <style>
      .table td,
      th,
      tbody,
      thead {
        text-align: center;
        cursor: pointer;
      }
      .upload_image td,
      th,
      tbody,
      thead {
        text-align: center;
        cursor: pointer;
      }

      .modal {
        overflow: auto !important;
      }
    </style>
  </head>

  <body>
    <!-- Page Preloder -->
    <div id="preloder">
      <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Section Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="canvas-open">
      <i class="icon_menu"></i>
    </div>
    <div class="offcanvas-menu-wrapper">
      <div class="canvas-close">
        <i class="icon_close"></i>
      </div>
      <nav class="mainmenu mobile-menu">
        <ul>
          <li><a href="../../index.html">Home</a></li>
          <li><a href="../../rooms.html">Rooms</a></li>
          <li><a href="../../about-us.html">Gallery</a></li>
          <li><a href="../../blog-details.html">About Us</a></li>
          <li><a href="../../contact.html">Contact</a></li>
          <li class="active">
            <a href="../Mybooking.html">
              My Booking
              <i class="fa fa-search" aria-hidden="true"></i
            ></a>
          </li>
        </ul>
      </nav>
      <div id="mobile-menu-wrap"></div>
      <div class="top-social"></div>
      <ul class="top-widget">
        <li><i class="fa fa-phone"></i> (12) 345 67890</li>
        <li><i class="fa fa-envelope"></i> fairfieldsresort2020@gmail.com</li>
      </ul>
    </div>
    <!-- Offcanvas Menu Section End -->

    <!-- Header Section Begin -->
    <header class="header-section header-normal">
      <div class="menu-item">
        <div class="container">
          <div class="row">
            <div class="col-lg-2">
              <div class="logo">
                <a href="../../index.html">
                  <img src="../../img/resort-logo.png" alt="" />
                </a>
              </div>
            </div>
            <div class="col-lg-10">
              <div class="nav-menu">
                <nav class="mainmenu">
                  <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../../rooms.html">Rooms</a></li>
                    <li>
                      <a href="../../about-us.html">Gallery</a>
                    </li>
                    <li>
                      <a href="../../blog-details.html">About Us</a>
                    </li>
                    <li><a href="../../contact.html">Contact</a></li>
                    <li class="active">
                      <a href="../mybooking.html">
                        My Booking
                        <i class="fa fa-search" aria-hidden="true"></i
                      ></a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Header End -->

    <!-- Contact Section Begin -->
    <section class="contact-section spad">
      <div class="container">
        <div class="d-flex justify-content-center mt-2">
          <div class="card" style="width: 70rem">
            <div class="invoice p-3 mb-3">
              <!-- title row -->
              <div class="row">
                <div class="col-12">
                  <h4>
                    <img
                      src="../../admin/dist/img/resort.png"
                      style="height: 80px"
                      class="img-fluid"
                    />Fairfields Resort &amp; Playhouse Inn
                    <!--<small class="float-right">Date: 2/10/2014</small>-->
                  </h4>
                </div>
                <!-- /.col -->
              </div>
              <!-- info row -->
              <div class="row invoice-info text-center">
                <div class="col-sm-6 invoice-col">
                  <h4>Guest Information</h4>
                  <address>
                    <strong id="guest_name"></strong><br />
                    <p class="m-0">
                      Address: <strong id="guest_address"></strong>
                    </p>
                    <p class="m-0">
                      Phone: <text id="guest_contact"></text>
                    </p>
                    <p class="m-0">
                      Email: <text id="guest_email"></text>
                    </p>
                  </address>
                </div>
                <!-- /.col -->
                <div class="col-sm-6 invoice-col">
                  <h4>Booking Information</h4>
                  <address>
                    <p class="m-0">Check-in: <strong id="check_in"></strong></p>
                    <p class="m-0">
                      Check-out:
                      <strong id="check_out"></strong>
                    </p>
                    <p class="m-0">
                      No. Night(s): <strong id="nights"></strong>
                    </p>
                    <p class="m-0">
                      No. Guest: <strong id="guest_num"></strong>
                    </p>
                  </address>
                </div>
                <!-- /.col -->
                <!--<div class="col-sm-4 invoice-col">
                        <b>Invoice #007612</b><br />
                        <br />
                        <b>Order ID:</b> 4F3S8J<br />
                        <b>Payment Due:</b> 2/22/2014<br />
                        <b>Account:</b> 968-34567
                      </div> -->
                <!-- /.col -->
              </div>
              <!-- /.row -->

              <!-- Table row -->
              <div class="row">
                <div class="col-12 table-responsive">
                  <table id="invoice" class="table table-striped">
                    <thead>
                      <tr>
                        <th>Availed Room</th>
                        <th>Rate</th>
                        <th>Night(s)</th>
                        <th>Qty</th>
                        <th>Amount</th>
                      </tr>
                    </thead>
                    <tbody id="#invoice"></tbody>
                    <tfoot>
                      <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>Vatable Sales</th>
                        <th id="vatable">PHP 3520.00</th>
                      </tr>
                      <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>VAT (12%)</th>
                        <th id="vat">PHP 480.00</th>
                      </tr>
                      <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>Sub Total</th>
                        <th id="sub_total">PHP 4000.00</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
                <!-- /.col -->
              </div>
              <!-- /.row -->

              <!-- this row will not appear when printing -->
              <div class="row no-print">
                <div class="col-12">
                
                  <button
                    type="button"
                    class="btn btn-success float-right"
                    id="confirm"
                  >
                    CONFIRM
                  </button>
                  <!--<button
                          type="button"
                          class="btn btn-primary float-right"
                          style="margin-right: 5px;"
                        >
                          <i class="fas fa-download"></i> Generate PDF
                        </button>-->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Contact Section End -->

    <!-- Footer Section Begin -->
    <!-- Footer Section Begin -->
    <footer class="footer-section">
      <div class="container">
        <div class="footer-text">
          <div class="row">
            <div class="col-lg-6">
              <div class="ft-about">
                <div class="logo">
                  <a href="#">
                    <img src="../../img/name-logo.png" alt="" class="ml-n3" />
                  </a>
                </div>
                <div class="fa-social">
                  <a href="#"><i class="fa fa-facebook"></i></a>
                </div>
              </div>
            </div>
            <div class="col-lg-3 offset-lg-1">
              <div class="ft-contact">
                <h6>Contact Us</h6>
                <ul>
                  <li>(63) 93 5536 0312</li>
                  <li>fairfieldsresort@yahoo.com</li>
                  <li>Padilla St. 2420 San Carlos City, Pangasinan</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="copyright-option">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="co-text">
                <p>
                  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                  Copyright &copy;
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  All rights reserved
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Search model Begin -->
    <div class="search-model">
      <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch"><i class="icon_close"></i></div>
        <form class="search-model-form">
          <input type="text" id="search-input" placeholder="Search here....." />
        </form>
      </div>
    </div>
    <!-- Search model end -->

    <!-- Js Plugins -->
    <script src="../../js/jquery-3.3.1.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/jquery.magnific-popup.min.js"></script>
    <script src="../../js/jquery-ui.min.js"></script>
    <script src="../../js/jquery.slicknav.js"></script>
    <script src="../../js/owl.carousel.min.js"></script>
    <script src="../../js/main.js"></script>
    <script src="../../admin/plugins/sweetalert2/sweetalert2.min.js"></script>
    <script src="../../admin/plugins/toastr/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="../datepicker_files/jquery.datepicker2.js"></script>
    <script src="../../admin/plugins/datatables/jquery.dataTables.js"></script>
    <script src="../../admin/plugins/datatables-bs4/js/dataTables.bootstrap4.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  </body>

  <script>
    $(document).ready(() => {
      let reservation_id = sessionStorage.getItem("my_booking_reservationid");
      let billing_id = sessionStorage.getItem("my_booking_billingid");
      let guest_id = sessionStorage.getItem("my_booking_guestid");
      let num_guest = sessionStorage.getItem("change_numguest");

      if (guest_id == null || guest_id == undefined)
        window.location = "../../my_booking.html";

      var today = moment();
      var tomorrow = moment(today).add(1, "days");

      let check_in = new Date(sessionStorage.getItem("change_checkin"));
      let check_out = new Date(sessionStorage.getItem("change_checkout"));

      let timediff = check_out.getTime() - check_in.getTime();
      let nights = timediff / (1000 * 3600 * 24);

      $("#check_in").html(
        moment(sessionStorage.getItem("change_checkin")).format("DD MMMM YYYY")
      );
      $("#check_out").html(
        moment(sessionStorage.getItem("change_checkout")).format("DD MMMM YYYY")
      );
      $("#nights").html(nights);
      $("#guest_num").html(num_guest);

      $.ajax({
        url: "../../php_functions/change_booking/get_guest_details.php",
        data:
          "guest_id=" +
          guest_id,
        type: "POST",
        success: function (response) {
          console.log(JSON.parse(response))
         JSON.parse(response).map((e) => {
            $("#guest_name").html(
        e.first_name + " " + e.last_name
      );
            $("#guest_address").html(e.addressline_1+ ", " +e.city + ", "+ e.zipcode);
      $("#guest_contact").html(e.contact_number);
      $("#guest_email").html(e.email);
         })
        },
      });

      let room_details = JSON.parse(
        sessionStorage.getItem("change_room_details")
      );

      let sub_total = 0;
      room_details.map((room) => {
        sub_total += room.new_price;
        $("#invoice").append(
          "<tr>" +
            "<td>" +
            room.roomtype_name +
            "</td>" +
            "<td>PHP " +
            room.new_price / room.num_rooms / nights +
            ".00</td>" +
            "<td>" +
            nights +
            "</td>" +
            "<td>" +
            room.num_rooms +
            "</td>" +
            "<td>PHP " +
            room.new_price +
            ".00</td>" +
            "</tr>"
        );
      });

      let total_amount = sub_total;
      let VAT = total_amount * 0.12;
      let vatable_sales = total_amount - VAT;
      let downpayment = total_amount / 2;

      $("#vatable").html("PHP " + vatable_sales + ".00");
      $("#vat").html("PHP " + VAT + ".00");
      $("#sub_total").html("PHP " + total_amount + ".00");
      $("#downpayment").html("PHP " + downpayment + ".00");
      $("#total_amount").html("PHP " + total_amount + ".00");

      let selected_rooms = [];

      $("#confirm").click(() => {
        $("#confirm").attr("disabled", "disabled");
        $.LoadingOverlay("show", {
          image: "",
          progress: true,
        });
        var count = 0;
        var interval = setInterval(function () {
          if (count >= 100) {
            clearInterval(interval);
            $.LoadingOverlay("hide");
            return;
          }
          count += 20;
          $.LoadingOverlay("progress", count);
        }, 300);

        room_details.map((room) => {
          room.room_ids.map((rooms) => {
            selected_rooms.push(rooms);
          });
        });

        let new_check_in = moment(check_in).format("YYYY-MM-DD");
        let new_check_out = moment(check_out).format("YYYY-MM-DD");

        $.ajax({
          url: "../../php_functions/validate_rooms.php",
          data:
            "selected_rooms=" +
            JSON.stringify(selected_rooms) +
            "&checkin_date=" +
            new_check_in +
            "&checkout_date=" +
            new_check_out,
          type: "POST",
          success: function (response) {
            let res = response;
            if (res == '"1"') {
              if (moment(tomorrow._d).format("YYYY-MM-DD") == new_check_in) {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text:
                      "You have until today 11:59PM to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              } else {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text:
                      "You have 24 Hours to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              }

              $.ajax({
                url:
                  "../../php_functions/change_booking/insert_reservation.php",
                data:
                  "guest_id=" +
                  guest_id +
                  "&reservation_id=" +
                  reservation_id +
                  "&billing_id=" +
                  billing_id +
                  "&checkin_date=" +
                  new_check_in +
                  "&num_guest=" +
                  num_guest +
                  "&checkout_date=" +
                  new_check_out +
                  "&room_details=" +
                  JSON.stringify(room_details),
                type: "POST",
                success: function (response) {
                  localStorage.clear();
                },
              });

              setTimeout(() => {
                window.location = "../mybooking.html";
              }, 7200);
            } else {
              setTimeout(function () {
                Swal.fire({
                  icon: "warning",
                  title: "Oops...",
                  text:
                    "Something went wrong!, Booking Unsuccessfull. Try other dates",
                  footer:
                    "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                  timer: 5000,
                  showCancelButton: false,
                  showConfirmButton: false,
                });
              }, 2100);

              setTimeout(() => {
                window.location = "../mybooking.html";
              }, 7100);
            }
          },
        });
      });
    });
  </script>
</html>
